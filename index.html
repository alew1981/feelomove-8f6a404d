<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    
    <!-- CRITICAL: Preconnect hints FIRST for maximum effect (max 4 recommended) -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link rel="preconnect" href="https://ik.imagekit.io" crossorigin="">
    <link rel="preconnect" href="https://wcyjuytpxxqailtixept.supabase.co" crossorigin="">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FEELOMOVE+ | Entradas Conciertos y Festivales España</title>
    
    <!-- Security Headers (enforced at server level via vercel.json) -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    <!-- NOTA: Todos los metatags SEO (title, description, canonical, og:*, twitter:*) 
         son gestionados EXCLUSIVAMENTE por react-helmet-async en SEOHead.tsx -->
    <meta name="impact-site-verification" content="7cc879ee-e195-4865-9dd5-6dc6eb167203">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg?v=2" />
    <link rel="shortcut icon" type="image/svg+xml" href="/favicon.svg?v=2" />
    <link rel="apple-touch-icon" href="/favicon.svg?v=2" />
    
    <!-- dns-prefetch for secondary/tertiary origins -->
    <link rel="dns-prefetch" href="https://s1.ticketm.net">
    <link rel="dns-prefetch" href="https://ik.imagekit.io">
    
    <!-- Font preload removed - inline @font-face with font-display:swap is sufficient -->
    
    <!-- LCP Hero: NO preload - la imagen de 1.3MB no se carga en móvil (conditional render via React) -->
    <!-- Desktop carga bajo demanda via ImageKit CDN con compresión automática -->
    
    
    <!-- CRITICAL CSS: Inline styles for instant FCP (< 0.5s) -->
    <style>
      /* === CRITICAL FONT-FACE === */
      @font-face {
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/poppins/v24/pxiEyp8kv8JHgFVrJJfecg.woff2) format('woff2');
      }
      @font-face {
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 600;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/poppins/v24/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2) format('woff2');
      }
      @font-face {
        font-family: 'Poppins';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/poppins/v24/pxiByp8kv8JHgFVrLCz7Z1xlFQ.woff2) format('woff2');
      }
      
      /* === CRITICAL RESET & LAYOUT === */
      *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
      html{-webkit-text-size-adjust:100%;font-family:'Poppins',system-ui,-apple-system,sans-serif;scroll-behavior:smooth}
      body{background:#121212;color:#fff;min-height:100vh;line-height:1.5}
      #root{min-height:100vh;display:flex;flex-direction:column}
      
      /* === CRITICAL NAVBAR (fixed, instant paint) === */
      .navbar-critical{position:fixed;top:0;left:0;right:0;z-index:50;height:64px;background:rgba(18,18,18,0.95);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;padding:0 16px}
      .navbar-critical .logo{height:32px;width:auto}
      .navbar-critical .nav-skeleton{display:flex;gap:24px;margin-left:auto}
      .navbar-critical .nav-item{width:60px;height:16px;background:rgba(255,255,255,0.1);border-radius:4px}
      @media(max-width:768px){.navbar-critical .nav-skeleton{display:none}}
      
      /* === CRITICAL HERO SKELETON (LCP placeholder) === */
      .hero-skeleton{margin-top:80px;padding:0 16px}
      .hero-skeleton .breadcrumb{height:20px;width:200px;background:rgba(255,255,255,0.05);border-radius:4px;margin-bottom:16px}
      .hero-skeleton .image-container{position:relative;width:100%;height:200px;background:linear-gradient(135deg,rgba(255,255,255,0.05) 0%,rgba(255,255,255,0.02) 100%);border-radius:16px;overflow:hidden}
      @media(min-width:640px){.hero-skeleton .image-container{height:340px}}
      @media(min-width:768px){.hero-skeleton .image-container{height:420px}}
      .hero-skeleton .image-container::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.04),transparent);animation:shimmer 1.5s infinite}
      @keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
      
      /* === CRITICAL CONTENT SKELETON === */
      .content-skeleton{padding:16px;display:flex;flex-direction:column;gap:12px}
      .content-skeleton .title{height:28px;width:70%;background:rgba(255,255,255,0.08);border-radius:6px}
      .content-skeleton .subtitle{height:18px;width:50%;background:rgba(255,255,255,0.05);border-radius:4px}
      .content-skeleton .meta{height:14px;width:40%;background:rgba(255,255,255,0.03);border-radius:4px}
      
      /* === FORCE LCP IMAGE PRIORITY === */
      img[fetchpriority="high"]{content-visibility:visible!important}
      img:not([fetchpriority="high"]){content-visibility:auto}
      
      /* === PREVENT FOUC === */
      .loading-screen{position:fixed;inset:0;background:#121212;z-index:9999;display:flex;align-items:center;justify-content:center;opacity:1;transition:opacity 0.2s}
      .loading-screen.hidden{opacity:0;pointer-events:none}
    </style>
    
    <!-- ASYNC CSS LOADING: Preload then swap to stylesheet -->
    <link rel="preload" href="/src/index.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/src/index.css"></noscript>
  </head>

  <body>
    <!-- SEO FALLBACK: Contenido visible para crawlers antes de que React hidrate -->
    <!-- Este contenido se oculta cuando React monta, pero es indexable por Google/Ahrefs -->
    <div id="seo-fallback" style="position:absolute;left:-9999px;top:0;width:1px;height:1px;overflow:hidden;">
      <h1 id="seo-fallback-h1">FEELOMOVE+</h1>
      <p id="seo-fallback-description"></p>
      <nav aria-label="Navegación principal">
        <a href="/conciertos">Conciertos en España</a>
        <a href="/festivales">Festivales de Música</a>
        <a href="/destinos">Destinos</a>
        <a href="/artistas">Artistas</a>
        <a href="/musica">Géneros Musicales</a>
      </nav>
      <section>
        <h2 id="seo-fallback-h2"></h2>
        <p id="seo-fallback-section-text"></p>
      </section>
    </div>
    
    <!-- CRITICAL SKELETON: Visual placeholder while React loads -->
    <div id="critical-skeleton">
      <!-- Navbar skeleton -->
      <div class="navbar-critical">
        <a href="/" title="FEELOMOVE+ - Inicio">
          <svg class="logo" viewBox="0 0 120 32" fill="none" aria-label="FEELOMOVE+ Logo">
            <text x="0" y="24" fill="#00FF8F" font-family="Poppins" font-weight="700" font-size="18">FEELOMOVE</text>
            <text x="108" y="24" fill="#00FF8F" font-family="Poppins" font-weight="700" font-size="14">+</text>
          </svg>
        </a>
        <nav class="nav-skeleton" aria-label="Navegación">
          <a href="/conciertos" class="nav-item" style="color:transparent;">Conciertos</a>
          <a href="/festivales" class="nav-item" style="color:transparent;">Festivales</a>
          <a href="/destinos" class="nav-item" style="color:transparent;">Destinos</a>
        </nav>
      </div>
      <!-- Hero skeleton with semantic content -->
      <main class="hero-skeleton">
        <div class="breadcrumb"></div>
        <div class="image-container" role="img" aria-label="Imagen del evento"></div>
        <div class="content-skeleton">
          <div class="title"></div>
          <div class="subtitle"></div>
          <div class="meta"></div>
        </div>
      </main>
    </div>
    
    <!-- React root - skeleton hidden when React mounts -->
    <div id="root"></div>
    
    <!-- Hide skeleton once React renders -->
    <script>
      // Remove critical skeleton once React hydrates (non-blocking)
      window.addEventListener('DOMContentLoaded', function() {
        requestAnimationFrame(function() {
          var skeleton = document.getElementById('critical-skeleton');
          if (skeleton) skeleton.style.display = 'none';
        });
      });
    </script>
    
    <!-- SEO PRE-REACT: Inject popular event links BEFORE React hydrates -->
    <!-- This ensures crawlers (Ahrefs, Google) see links immediately in raw HTML -->
    <script>
      (function() {
        var abortController = new AbortController();
        var timeoutId = setTimeout(function() { abortController.abort(); }, 5000);
        
        fetch('https://wcyjuytpxxqailtixept.supabase.co/functions/v1/popular-events', {
          signal: abortController.signal
        })
          .then(function(r) { return r.json(); })
          .then(function(events) {
            clearTimeout(timeoutId);
            var fallback = document.getElementById('seo-fallback');
            if (!fallback || !Array.isArray(events)) return;
            
            var ul = document.createElement('ul');
            ul.id = 'seo-fallback-event-links';
            ul.setAttribute('aria-label', 'Eventos populares');
            
            events.forEach(function(e) {
              if (!e.slug) return;
              var li = document.createElement('li');
              var a = document.createElement('a');
              a.href = '/conciertos/' + e.slug;
              a.textContent = 'Entradas ' + (e.artist_name || e.name);
              li.appendChild(a);
              ul.appendChild(li);
            });
            
            fallback.appendChild(ul);
          })
          .catch(function() { clearTimeout(timeoutId); });
      })();
    </script>
    
    <!-- Main app script -->
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- INTERACTION-TRIGGERED: GTM only loads on first user interaction (scroll/mouse/touch) -->
    <script>
      (function() {
        var gtmLoaded = false;
        
        function loadGTM() {
          if (gtmLoaded) return;
          gtmLoaded = true;
          
          // Remove all listeners immediately
          ['scroll', 'mousemove', 'touchstart', 'keydown', 'click'].forEach(function(evt) {
            window.removeEventListener(evt, loadGTM, { passive: true, capture: true });
          });
          
          // Load GTM
          window.dataLayer = window.dataLayer || [];
          window.dataLayer.push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
          
          var gtmScript = document.createElement('script');
          gtmScript.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-5VPZ5LH';
          gtmScript.async = true;
          document.head.appendChild(gtmScript);
        }
        
        // Add passive listeners for user interaction
        ['scroll', 'mousemove', 'touchstart', 'keydown', 'click'].forEach(function(evt) {
          window.addEventListener(evt, loadGTM, { passive: true, capture: true, once: true });
        });
      })();
    </script>
    
    <!-- GTM noscript fallback (hidden, non-blocking) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5VPZ5LH"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  </body>
</html>